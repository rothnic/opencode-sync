# Example: Copilot Agent Setup
# Save this as .github/workflows/copilot-setup-steps.yml in your repository
#
# This example uses the opencode-sync action to restore auth.
# The action handles: install, auth restoration, and headless mode.

name: Copilot Setup Steps

on: workflow_dispatch

jobs:
  setup:
    runs-on: ubuntu-latest
    environment: copilot
    
    steps:
      - uses: actions/checkout@v4

      - name: Install Bun
        uses: oven-sh/setup-bun@v2

      # Use the opencode-sync action instead of manual shell commands
      # This ensures the restore logic stays in sync with the canonical implementation
      - name: Restore OpenCode Identity
        uses: rothnic/opencode-sync@v1
        with:
          bundle: ${{ secrets.OPENCODE_AUTH_BUNDLE }}
          # install: true (default) - installs opencode-ai and plugins
          # headless: true (default) - sets OPENCODE_HEADLESS=1

      - name: Verify auth
        run: opencode auth status
